<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Industrial Chronograph</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Space Mono (Numbers), Archivo (UI) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Archivo:ital,wght@0,400;0,700;0,900;1,400&family=Space+Mono:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">

    <style>
        :root {
            /* Palette: 60s Industrial Design */
            --bg-color: #ECEBE4;
            --surface-color: #E2E1D9;
            --ink-color: #1A1A1A;
            --accent-orange: #FF4400;
            --accent-orange-dark: #CC3600;
            --accent-grey: #8A8A8A;
            --grid-line: #D1D0C8;
        }

        body {
            font-family: 'Archivo', sans-serif;
            background-color: var(--bg-color);
            color: var(--ink-color);
            -webkit-font-smoothing: antialiased;
            overflow: hidden; /* Prevent pull-to-refresh on mobile */
        }

        /* Noise Texture overlay for analog feel */
        .noise-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 50;
            opacity: 0.04;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
        }

        /* Typography Utilities */
        .font-mono-display {
            font-family: 'Space Mono', monospace;
            font-variant-numeric: tabular-nums;
            letter-spacing: -0.05em;
        }

        /* 3D Tactile Buttons */
        .btn-tactile {
            position: relative;
            transition: all 0.1s cubic-bezier(0.4, 0, 0.2, 1);
            transform: translateY(0);
        }
        
        /* Orange Button (Main Action) */
        .btn-orange {
            background-color: var(--accent-orange);
            color: white;
            border: 2px solid var(--ink-color);
            box-shadow: 4px 4px 0 var(--ink-color);
        }
        .btn-orange:active:not(:disabled) {
            transform: translate(4px, 4px);
            box-shadow: 0 0 0 var(--ink-color);
        }
        .btn-orange:disabled {
            background-color: var(--accent-grey);
            opacity: 0.5;
            box-shadow: none;
            border-color: #aaa;
            cursor: not-allowed;
            transform: translate(2px, 2px);
        }

        /* White Button (Secondary Action) */
        .btn-white {
            background-color: #fff;
            color: var(--ink-color);
            border: 2px solid var(--ink-color);
            box-shadow: 4px 4px 0 var(--ink-color);
        }
        .btn-white:active:not(:disabled) {
            transform: translate(4px, 4px);
            box-shadow: 0 0 0 var(--ink-color);
        }
        .btn-white:disabled {
            opacity: 0.4;
            box-shadow: none;
            border-color: #aaa;
            cursor: not-allowed;
            transform: translate(2px, 2px);
        }

        /* Input styling (Underline only) */
        .input-memo {
            background: transparent;
            border: none;
            border-bottom: 1px dashed #aaa;
            border-radius: 0;
            padding: 4px 0;
            font-family: 'Space Mono', monospace;
            font-size: 0.85rem;
            width: 100%;
            color: #555;
            transition: border-color 0.2s;
        }
        .input-memo:focus {
            outline: none;
            border-bottom: 1px solid var(--accent-orange);
            color: var(--ink-color);
        }

        /* Animations */
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .lap-entry {
            animation: slideIn 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        /* Custom Scrollbar */
        .custom-scroll::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scroll::-webkit-scrollbar-track {
            background: transparent;
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background-color: #ccc;
            border-radius: 3px;
        }
    </style>
</head>
<body class="h-[100dvh] flex flex-col items-center justify-center bg-[#333]"> <!-- Outer wrapper for desktop centering -->
    
    <!-- Noise Texture -->
    <div class="noise-overlay"></div>

    <!-- App Container (Mobile size locked) -->
    <main class="relative w-full h-full max-w-md bg-[#ECEBE4] flex flex-col shadow-2xl overflow-hidden md:h-[90vh] md:rounded-xl md:border-4 md:border-[#1a1a1a]">
        
        <!-- Header / Display Area -->
        <header class="flex-none pt-10 pb-6 px-6 relative z-10 border-b-2 border-[#1a1a1a]">
            <div class="flex justify-between items-end mb-2 opacity-60">
                <h1 class="text-xs font-black tracking-[0.2em] uppercase">Chronograph</h1>
                <div class="text-[0.6rem] font-bold tracking-widest uppercase border border-black px-1 rounded-sm">Type-01</div>
            </div>
            
            <div class="relative mt-2">
                <!-- Main Time Display -->
                <div id="display" class="font-mono-display text-[4.5rem] leading-none font-bold tracking-tighter text-[#1a1a1a]">
                    00:00<span class="text-3xl align-top opacity-50">.00</span>
                </div>
            </div>
        </header>

        <!-- List Area (The "Paper Tape") -->
        <div class="flex-1 relative bg-[#F4F4F0]">
            <!-- List Header -->
            <div class="absolute top-0 left-0 right-0 flex justify-between px-5 py-2 text-[0.65rem] font-bold uppercase tracking-widest text-gray-400 bg-[#F4F4F0] border-b border-[#D1D0C8] z-10">
                <span>Split / Memo</span>
                <span>Cumulative</span>
            </div>

            <!-- Scrollable Content -->
            <div id="laps-container" class="custom-scroll absolute top-8 bottom-0 left-0 right-0 overflow-y-auto px-4 py-4 space-y-3">
                
                <!-- Empty State -->
                <div id="empty-state" class="h-40 flex flex-col items-center justify-center opacity-30 mt-10">
                    <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" class="mb-2">
                        <circle cx="12" cy="12" r="10"></circle>
                        <polyline points="12 6 12 12 16 14"></polyline>
                    </svg>
                    <p class="font-mono-display text-xs">READY TO RECORD</p>
                </div>

            </div>
            
            <!-- Bottom Fade for list -->
            <div class="absolute bottom-0 left-0 w-full h-6 bg-gradient-to-t from-[#F4F4F0] to-transparent pointer-events-none z-10"></div>
        </div>

        <!-- Controls Area (Fixed Bottom) -->
        <div class="flex-none bg-[#E2E1D9] border-t-2 border-[#1a1a1a] p-5 pb-8 z-20">
            <!-- Grid Layout for Ergonomics -->
            <div class="grid grid-cols-2 gap-4 h-36">
                
                <!-- TOP LEFT: STOP (Safety) -->
                <button id="btn-stop" class="btn-tactile btn-white rounded-md flex flex-col items-center justify-center group" disabled>
                    <span class="text-xs font-bold tracking-widest mb-1 group-active:translate-y-0.5 transition-transform">STOP</span>
                    <div class="w-8 h-1 bg-gray-800 rounded-full opacity-20 group-active:opacity-10"></div>
                </button>

                <!-- TOP RIGHT: START (Primary Thumb Zone) -->
                <button id="btn-start" class="btn-tactile btn-orange rounded-md flex flex-col items-center justify-center group">
                    <span id="label-start" class="text-xl font-black tracking-widest mb-1 group-active:translate-y-0.5 transition-transform">START</span>
                    <!-- Icon visualization -->
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" class="opacity-80 group-active:translate-y-0.5 transition-transform">
                        <polygon points="5 3 19 12 5 21 5 3"></polygon>
                    </svg>
                </button>

                <!-- BOTTOM LEFT: RESET (Destructive) -->
                <button id="btn-reset" class="btn-tactile btn-white rounded-md flex items-center justify-center opacity-80" disabled>
                    <span class="text-xs font-bold tracking-widest text-gray-500">RESET</span>
                </button>

                <!-- BOTTOM RIGHT: LAP (Secondary Thumb Zone) -->
                <button id="btn-lap" class="btn-tactile btn-white rounded-md flex flex-col items-center justify-center group" disabled>
                    <span class="text-sm font-bold tracking-widest mb-1 text-gray-800 group-active:translate-y-0.5 transition-transform">LAP</span>
                    <div class="w-1 h-1 bg-gray-800 rounded-full mb-1"></div>
                    <div class="w-1 h-1 bg-gray-800 rounded-full"></div>
                </button>

            </div>
        </div>
    </main>

    <script>
        /**
         * Logic: High Precision Stopwatch
         * Optimized for minimal DOM reflows during the loop.
         */
        
        // --- State ---
        const STATE = { IDLE: 'IDLE', RUNNING: 'RUNNING', PAUSED: 'PAUSED' };
        let appState = STATE.IDLE;
        
        let startTime = 0;
        let elapsedTime = 0;
        let animationFrameId = null;
        
        let lapCount = 0;
        let lastLapTime = 0;

        // --- Elements ---
        const dom = {
            display: document.getElementById('display'),
            btnStart: document.getElementById('btn-start'),
            btnStop: document.getElementById('btn-stop'),
            btnReset: document.getElementById('btn-reset'),
            btnLap: document.getElementById('btn-lap'),
            labelStart: document.getElementById('label-start'),
            container: document.getElementById('laps-container'),
            emptyState: document.getElementById('empty-state')
        };

        // --- Formatter (Micro-optimization: reuse strings) ---
        const formatTime = (ms) => {
            const m = Math.floor(ms / 60000);
            const s = Math.floor((ms % 60000) / 1000);
            const cs = Math.floor((ms % 1000) / 10);
            
            // Using template literals for readability, but in tight loops string concat is fine too
            const mm = m < 10 ? '0' + m : m;
            const ss = s < 10 ? '0' + s : s;
            const ccs = cs < 10 ? '0' + cs : cs;
            
            return { mm, ss, ccs, full: `${mm}:${ss}`, decimal: `.${ccs}` };
        };

        // --- Render Loop ---
        const updateTimerDisplay = (ms) => {
            const t = formatTime(ms);
            // Specifically targeting innerHTML to style the decimal part differently (smaller opacity)
            dom.display.innerHTML = `${t.full}<span class="text-3xl align-top opacity-50 font-medium">${t.decimal}</span>`;
        };

        const tick = () => {
            if (appState !== STATE.RUNNING) return;
            
            const now = Date.now();
            const currentTotal = elapsedTime + (now - startTime);
            updateTimerDisplay(currentTotal);
            
            animationFrameId = requestAnimationFrame(tick);
        };

        // --- UI State Management ---
        const setUIState = (state) => {
            appState = state;
            
            switch (state) {
                case STATE.IDLE:
                    dom.btnStart.disabled = false;
                    dom.btnStart.classList.replace('btn-white', 'btn-orange');
                    dom.labelStart.textContent = "START";
                    
                    dom.btnStop.disabled = true;
                    dom.btnReset.disabled = true;
                    dom.btnLap.disabled = true;
                    break;
                    
                case STATE.RUNNING:
                    dom.btnStart.disabled = true; // Visually disabled but keeps layout
                    
                    dom.btnStop.disabled = false;
                    dom.btnReset.disabled = true;
                    dom.btnLap.disabled = false;
                    break;
                    
                case STATE.PAUSED:
                    dom.btnStart.disabled = false;
                    dom.labelStart.textContent = "RESUME";
                    
                    dom.btnStop.disabled = true;
                    dom.btnReset.disabled = false; // Reset allowed here
                    dom.btnLap.disabled = true;
                    break;
            }
        };

        // --- Actions ---

        dom.btnStart.addEventListener('click', () => {
            if (appState === STATE.RUNNING) return; // Prevention
            
            startTime = Date.now();
            setUIState(STATE.RUNNING);
            tick();
        });

        dom.btnStop.addEventListener('click', () => {
            if (appState !== STATE.RUNNING) return;
            
            const now = Date.now();
            elapsedTime += (now - startTime);
            cancelAnimationFrame(animationFrameId);
            
            updateTimerDisplay(elapsedTime); // Ensure final frame is accurate
            setUIState(STATE.PAUSED);
        });

        dom.btnReset.addEventListener('click', () => {
            cancelAnimationFrame(animationFrameId);
            elapsedTime = 0;
            startTime = 0;
            lastLapTime = 0;
            lapCount = 0;
            
            updateTimerDisplay(0);
            setUIState(STATE.IDLE);
            
            // Clear Laps
            dom.container.innerHTML = '';
            dom.container.appendChild(dom.emptyState);
            dom.emptyState.style.display = 'flex';
        });

        dom.btnLap.addEventListener('click', () => {
            if (appState !== STATE.RUNNING) return;
            
            const now = Date.now();
            const currentTotal = elapsedTime + (now - startTime);
            
            recordLap(currentTotal);
        });

        // --- Lap Logic ---
        const recordLap = (currentTotal) => {
            if (dom.emptyState.style.display !== 'none') {
                dom.emptyState.style.display = 'none';
            }

            lapCount++;
            const splitTime = currentTotal - lastLapTime;
            lastLapTime = currentTotal;

            const split = formatTime(splitTime);
            const total = formatTime(currentTotal);

            // Create Lap Element
            const row = document.createElement('div');
            row.className = "lap-entry bg-white border-2 border-[#1a1a1a] p-3 shadow-[2px_2px_0_#ccc] rounded-sm flex flex-col gap-2";
            
            row.innerHTML = `
                <div class="flex justify-between items-baseline border-b border-dashed border-gray-200 pb-2">
                    <div class="flex items-center gap-3">
                        <span class="font-sans font-black text-xs bg-[#1a1a1a] text-white px-1.5 py-0.5 rounded-sm">#${lapCount}</span>
                        <span class="font-mono-display text-xl font-bold tracking-tight text-[#1a1a1a]">+${split.full}${split.decimal}</span>
                    </div>
                    <span class="font-mono-display text-xs text-gray-500">=${total.full}${total.decimal}</span>
                </div>
                <div>
                    <input type="text" 
                           class="input-memo placeholder-gray-300" 
                           placeholder="Type note here..." 
                           enterkeyhint="done"
                    >
                </div>
            `;

            // Insert at top
            dom.container.prepend(row);
        };
        
        // Initial setup
        setUIState(STATE.IDLE);

    </script>
</body>
</html>
